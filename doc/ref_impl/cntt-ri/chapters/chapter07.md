[<< Back](../)

# 7. Integration
<p align="right"><img src="../figures/bogo_ifo.png" alt="scope" title="Scope" width="35%"/></p>

## Table of Contents
* [7.1 Introduction](#7.1)
* [7.2 Pre-requisites](#7.2)
* [7.3 Requirements Gathering](#7.3)
* [7.4 Access and Connectivity](#7.4)
* [7.5 Descriptor File Preparations](#7.5)
* [7.6 Deployment Installer & Install Steps](#7.6)
* [7.7 Deployment Validations](#7.7)
* [7.8 CICD Tool Chain (use of, process, and scripts)](#7.8)
* [7.9 Jenkins Setup & Job Creation](#7.9)
* [7.10 Compliance Validation (steps, process)](#7.10)

<a name="7.1"></a>
## 7.1 Introduction

The purpose of this chapter is to establish an operational run-book containing sequences and steps explaining, with enough detail, how to install a Reference Implementation (RI).

The term Run-Book is synonymous with "Cookbook", and either term will be used interchangeably to indicate that if a user follows the steps or procedures in the "book", the expected result will be an RI identical to the lab utilized by CNTT for the instantiation and certification of RI-1.

It is assumed that the reader of this chapter has the skill set to install Common NFVI on their own labs.

*   Covers installers, automation, etc.
*   Integration of installers and components.

<a name="7.2"></a>
## 7.2 Prerequisites

The following are pre-requisites to be completed in advance of software deployments:

1.  Bare-metal validations: confirming delivery, rack, stack, of env and that env is "ready" for software deployments (e.g. BIOS, firmware, boot order, health, disk config, port / socket validations, MAC/NIC status, etc)

<a name="7.3"></a>
## 7.3 Requirements Gathering

Requirements gathering processes and steps:

1.  RA Requirements Gathering process
2.  Infra Requirements and Selection Process

<a name="7.4"></a>
## 7.4 Access & Connectivity

Logical steps for lab access and connectivity.

Sample steps provided mimic those utilized for POD10 test lab access.

<a name="7.5"></a>
## 7.5 Descriptor File Preparations

Reference steps describing the use, creation, and implementation of descriptor files.

e.g. Descriptor file &/or Manifest creation (data elements, use/implementation, etc

<a name="7.6"></a>
## 7.6 Deployment Installer & Install Steps

Steps and precedures for installing and setting up the RI.

<a name="7.7"></a>
## 7.7 Deployment Validations

CNTT RI should be both verified as any OpenStack deployment and compliant with
the CNTT requirements which induces that the validation is composed of:
- the basic test cases as asked by the OPNFV release criteria
- the functional tests checking all OpenStack services and capabilities even if
  they are considered as optional in
  [RA1 Core OpenStack Services APIs]({{ "/doc/ref_arch/openstack/chapters/chapter05.html" | relative_url }})
- all test cases listed in
  [RC1 TC Requirements]({{ "/doc/ref_cert/lfn/chapters/chapter09.html" | relative_url }})

Like the
[classical Functest containers](https://functest.readthedocs.io/en/stable-hunter/testing/user/configguide/configguide.html),
all current test cases currently selected by CNTT leverages on
[Xtesting](https://xtesting.readthedocs.io/en/latest/) which provides the
common test case execution and the unified way to manage all the interactions
with the CI/CD components and with third-parties. Then all test jobs needed by
[RI](https://build.opnfv.org/ci/view/cntt/) are easily configured via simple
[Jenkins job templates](https://docs.openstack.org/infra/jenkins-job-builder/)
to run the full container list. For its part, Xtesting runs the tests,
publishes all test results in the
[centralized test database](http://testresults.opnfv.org/test/api/v1/results)
and all artifacts (reports, logs, etc.) to an
[S3 compatible storage service](http://artifacts.opnfv.org/).

[The yaml file](https://git.opnfv.org/releng/tree/jjb/airship/cntt.yaml)
configuring [LFN Jenkins](https://build.opnfv.org/) was firstly generated by
[Xtesting CI](https://galaxy.ansible.com/collivier/xtesting). It's worth
mentioning that everyone can deploy anywhere similar plug-and-play CI/CD
toolchains in a few commands via
[Xtesting CI](https://galaxy.ansible.com/collivier/xtesting).

To deploy the CI toolchain verifying OpenStack:
```bash
virtualenv functest
. functest/bin/activate
pip install ansible
ansible-galaxy install collivier.xtesting
git clone https://gerrit.opnfv.org/gerrit/functest functest-src
(cd functest-src && git checkout -b stable/hunter origin/stable/hunter)
ansible-playbook functest-src/ansible/site.yml
deactivate
rm -rf functest-src functest
```

To deploy the CI toolchain running CNTT Compliance:
```bash
virtualenv functest
. functest/bin/activate
pip install ansible
ansible-galaxy install collivier.xtesting
git clone https://gerrit.opnfv.org/gerrit/functest functest-src
(cd functest-src && git checkout -b stable/hunter origin/stable/hunter)
ansible-playbook functest-src/ansible/site.cntt.yml
deactivate
rm -rf functest-src functest
```

Conforming to the OPNFV release criteria, all testcases proposed in OPNFV
Functest healthcheck suite are firstly executed to quickly check the deployment
status before deeply testing the deployment which costs time. It's worth
mentioning that test cases can be skipped here.

| container                         | test case        | criteria (Jenkins) |
|-----------------------------------|------------------|:------------------:|
| opnfv/functest-healthcheck:hunter | connection_check | Success            |
| opnfv/functest-healthcheck:hunter | tenantnetwork1   | Success            |
| opnfv/functest-healthcheck:hunter | tenantnetwork2   | Success            |
| opnfv/functest-healthcheck:hunter | vmready1         | Success            |
| opnfv/functest-healthcheck:hunter | vmready2         | Success            |
| opnfv/functest-healthcheck:hunter | singlevm1        | Success            |
| opnfv/functest-healthcheck:hunter | singlevm2        | Success            |
| opnfv/functest-healthcheck:hunter | vping_ssh        | Success            |
| opnfv/functest-healthcheck:hunter | vping_userdata   | Success            |
| opnfv/functest-healthcheck:hunter | cinder_test      | Success            |
| opnfv/functest-healthcheck:hunter | odl              | Success            |
| opnfv/functest-healthcheck:hunter | tempest_smoke    | Success            |

Then all testcases proposed in OPNFV Functest smoke suite are executed to
verify all services and capabilities. It should be noted that they allow
skipping tests if optional services (e.g. Gnocchi, Barbican, etc.) or
capabilities (e.g. remote console access, Neutron BGPVPN or SFC, etc.) are
missing.

| container                   | test case                  | criteria (Jenkins) |
|-----------------------------|----------------------------|:------------------:|
| opnfv/functest-smoke:hunter | neutron-tempest-plugin-api | Success            |
| opnfv/functest-smoke:hunter | tempest_cinder             | Success            |
| opnfv/functest-smoke:hunter | tempest_keystone           | Success            |
| opnfv/functest-smoke:hunter | rally_sanity               | Success            |
| opnfv/functest-smoke:hunter | refstack_defcore           | Success            |
| opnfv/functest-smoke:hunter | tempest_full               | Success            |
| opnfv/functest-smoke:hunter | tempest_scenario           | Success            |
| opnfv/functest-smoke:hunter | tempest_slow               | Success            |
| opnfv/functest-smoke:hunter | patrole                    | Success            |
| opnfv/functest-smoke:hunter | neutron_trunk              | Success            |
| opnfv/functest-smoke:hunter | networking-bgpvpn          | Success            |
| opnfv/functest-smoke:hunter | networking-sfc             | Success            |
| opnfv/functest-smoke:hunter | barbican                   | Success            |

According to [RA1 Core OpenStack Services APIs]({{ "/doc/ref_arch/openstack/chapters/chapter05.html" | relative_url }})
and [RC1 TC Requirements]({{ "doc/ref_cert/lfn/chapters/chapter09.html" | relative_url }})
the following test cases are executed at the end.

| container                               | test case                  | criteria (Jenkins) |
|-----------------------------------------|----------------------------|:------------------:|
| opnfv/functest-smoke-cntt:hunter        | neutron-tempest-plugin-api | Success            |
| opnfv/functest-smoke-cntt:hunter        | tempest_cinder             | Success            |
| opnfv/functest-smoke-cntt:hunter        | tempest_keystone           | Success            |
| opnfv/functest-smoke-cntt:hunter        | rally_sanity               | Success            |
| opnfv/functest-smoke-cntt:hunter        | tempest_full               | Success            |
| opnfv/functest-smoke-cntt:hunter        | tempest_scenario           | Success            |
| opnfv/functest-smoke-cntt:hunter        | tempest_slow               | Success            |
| opnfv/functest-benchmarking-cntt:hunter | rally_full                 | Success            |
| opnfv/functest-benchmarking-cntt:hunter | rally_jobs                 | Success            |
| opnfv/functest-benchmarking-cntt:hunter | vmtp                       | Success            |
| opnfv/functest-benchmarking-cntt:hunter | shaker                     | Success            |
| opnfv/functest-vnf:hunter               | cloudify                   | Success            |
| opnfv/functest-vnf:hunter               | cloudify_ims               | Success            |
| opnfv/functest-vnf:hunter               | heat_ims                   | Success            |
| opnfv/functest-vnf:hunter               | vyos_vrouter               | Success            |
| opnfv/functest-vnf:hunter               | juju_epc                   | Success            |

<a name="7.8"></a>
## 7.8 CICD Tool Chain (use of, process, and scripts)]

Placeholder to describe the CICD tool chain used in RI validations.  

Include flow diagram.

<a name="7.9"></a>
## 7.9 Jenkins Setup & Job Creation

Placeholder to describe the process, access, steps, instance, etc, information for the setup of Jenkins, the jobs required for validation, and the results dashboard.

<a name="7.10"></a>
## 7.10 Compliance Validation (steps, process)

Placholder to describe the purpose, steps, and process, using the Jenkins Jobs, Tool Chain, and Test Case requirements mapping to perform validations.  
